[{"_path":"/plugins/graph","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"graph - Graphs plugin for Haraka","description":"Haraka graph plugin - Graphs","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"graph-plugin"},"children":[{"type":"text","value":"graph plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin logs accepted and rejected emails into a database and provides\na web server which you can browse to and view graphs over time of the\nplugins which rejected connections."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In order for this to work you need to install the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"sqlite3"}]},{"type":"text","value":" module via\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm install sqlite3"}]},{"type":"text","value":" in your Haraka directory."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"config settings are stored in config/graph.ini"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"db_file"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The file name (or :memory:), where data is stored"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"http_addr"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The IP address to listen on for http. Default: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"127.0.0.1"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"http_port"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The port to listen on for http. Default: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"8080"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ignore_re"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Regular expression to match plugins to ignore for logging.\nDefault: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"queue|graph|relay"}]}]}]}]},"navigation":{"title":"graph"},"_type":"markdown","_id":"content:8.plugins:graph.md","_source":"content","_file":"8.plugins/graph.md","_extension":"md"},{"_path":"/plugins/helo.checks","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"helo.checks - HELO Checks plugin for Haraka","description":"Haraka helo.checks plugin - Rejects messages with invalid HELO/EHLO","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"helochecks-plugin"},"children":[{"type":"text","value":"helo.checks plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin performs a number of checks on the HELO string."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"HELO strings are very often forged or dubious in spam and so this can be a\nhighly effective and false-positive free anti-spam measure."}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"helo.checks results can be accessed by subsequent plugins:"}]},{"type":"element","tag":"code","props":{"code":"var h = connection.results.get('helo.checks');\nif (h.pass && h.pass.length > 5) {\n    // nice job, you passed 6+ tests\n}\nif (h.fail && h.fail.length > 3) {\n    // yikes, you failed 4+ tests!\n}\nif (connection.results.has('helo.checks','pass', /^forward_dns/) {\n    // the HELO hostname is valid\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"var h = connection.results.get('helo.checks');\nif (h.pass && h.pass.length > 5) {\n    // nice job, you passed 6+ tests\n}\nif (h.fail && h.fail.length > 3) {\n    // yikes, you failed 4+ tests!\n}\nif (connection.results.has('helo.checks','pass', /^forward_dns/) {\n    // the HELO hostname is valid\n}\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"helo.checks.regexps"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"List of regular expressions to match against the HELO string. The regular\nexpressions are automatically wrapped in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"^"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"$"}]},{"type":"text","value":" so they always match\nthe entire string."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"helo.checks.ini"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"INI file which controls enabling of certain checks:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"dns_timeout=30"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"How many seconds to wait for DNS queries to timeout."}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"check"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"check"}]}]},{"type":"element","tag":"code","props":{"code":"* valid\\_hostname=true\n\n  Checks that the HELO has at least one '.' in it and the organizational\n  name is possible (ie, a host within a Public Suffix).\n\n* bare\\_ip=true\n\n  Checks for HELO <IP> where the IP is not surrounded by square brackets.\n  This is an RFC violation so should always be enabled.\n\n* dynamic=true\n\n  Checks to see if all or part the connecting IP address appears within\n  the HELO argument to indicate that the client has a dynamic IP address.\n\n* literal\\_mismatch=1|2|3\n\n  Checks to see if the IP literal used matches the connecting IP address.\n  If set to 1, the full IP must match.  If set to 2, the /24 must match.\n  If set to 3, the /24 may match, or the IP can be private (RFC 1918).\n\n* match\\_re=true\n\n  See above. This is merely an on/off toggle.\n\n* big\\_company=true\n\n  See below. This is merely an on/off toggle.\n\n* forward\\_dns=true\n\n  Perform a DNS lookup of the HELO hostname and validate that the IP of\n  the remote is included in the IP(s) of the HELO hostname.\n\n  This test requires that the valid\\_hostname check is also enabled.\n\n* rdns\\_match=true\n\n  Sees if the HELO hostname (or at least the domain) match the rDNS\n  hostname(s).\n\n* host\\_mismatch=true\n\n  If HELO is called multiple times, checks if the hostname differs between\n  EHLO invocations.\n\n* proto\\_mismatch=true\n\n  If EHLO was sent and the host later tries to then send HELO or vice-versa.\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* valid\\_hostname=true\n\n  Checks that the HELO has at least one '.' in it and the organizational\n  name is possible (ie, a host within a Public Suffix).\n\n* bare\\_ip=true\n\n  Checks for HELO <IP> where the IP is not surrounded by square brackets.\n  This is an RFC violation so should always be enabled.\n\n* dynamic=true\n\n  Checks to see if all or part the connecting IP address appears within\n  the HELO argument to indicate that the client has a dynamic IP address.\n\n* literal\\_mismatch=1|2|3\n\n  Checks to see if the IP literal used matches the connecting IP address.\n  If set to 1, the full IP must match.  If set to 2, the /24 must match.\n  If set to 3, the /24 may match, or the IP can be private (RFC 1918).\n\n* match\\_re=true\n\n  See above. This is merely an on/off toggle.\n\n* big\\_company=true\n\n  See below. This is merely an on/off toggle.\n\n* forward\\_dns=true\n\n  Perform a DNS lookup of the HELO hostname and validate that the IP of\n  the remote is included in the IP(s) of the HELO hostname.\n\n  This test requires that the valid\\_hostname check is also enabled.\n\n* rdns\\_match=true\n\n  Sees if the HELO hostname (or at least the domain) match the rDNS\n  hostname(s).\n\n* host\\_mismatch=true\n\n  If HELO is called multiple times, checks if the hostname differs between\n  EHLO invocations.\n\n* proto\\_mismatch=true\n\n  If EHLO was sent and the host later tries to then send HELO or vice-versa.\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"reject"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"reject"}]}]},{"type":"element","tag":"code","props":{"code":"For all of the checks included above, a matching key in the reject section\ncontrols whether messages that fail the test are rejected.\n\nDefaults shown:\n\n[reject]\nhost_mismatch=false\nliteral_mismatch=false\nproto_mismatch=false\nrdns_match=false\ndynamic=false\nbare_ip=false\nvalid_hostname=false\nforward_dns=false\nbig_company=false\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"For all of the checks included above, a matching key in the reject section\ncontrols whether messages that fail the test are rejected.\n\nDefaults shown:\n\n[reject]\nhost_mismatch=false\nliteral_mismatch=false\nproto_mismatch=false\nrdns_match=false\ndynamic=false\nbare_ip=false\nvalid_hostname=false\nforward_dns=false\nbig_company=false\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"skip"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"skip"}]}]},{"type":"element","tag":"code","props":{"code":"* private\\_ip=true\n\n  Bypasses checks for clients within RFC1918, Loopback or APIPA IP address ranges.\n\n* relaying\n\n  Bypass checks for clients who have relaying privileges (whitelisted IP,\n  SMTP-AUTH, etc).\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* private\\_ip=true\n\n  Bypasses checks for clients within RFC1918, Loopback or APIPA IP address ranges.\n\n* relaying\n\n  Bypass checks for clients who have relaying privileges (whitelisted IP,\n  SMTP-AUTH, etc).\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"bigco"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"bigco"}]}]},{"type":"element","tag":"code","props":{"code":"  A list of <helo>=<rdns>[,<rdns>...] to match against. If the HELO matches\n  what's on the left hand side, the reverse-DNS must match one of the\n  entries on the right hand side or the mail is blocked.\n\n  Example:\n\n        yahoo.com=yahoo.com,yahoo.co.jp\n        aol.com=aol.com\n        gmail.com=google.com\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  A list of <helo>=<rdns>[,<rdns>...] to match against. If the HELO matches\n  what's on the left hand side, the reverse-DNS must match one of the\n  entries on the right hand side or the mail is blocked.\n\n  Example:\n\n        yahoo.com=yahoo.com,yahoo.co.jp\n        aol.com=aol.com\n        gmail.com=google.com\n"}]}]}]}]},"navigation":{"title":"helo.checks"},"_type":"markdown","_id":"content:8.plugins:helo.checks.md","_source":"content","_file":"8.plugins/helo.checks.md","_extension":"md"}]