{"_path":"/plugins/redis","_dir":"plugins","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"redis - Redis plugin","description":"Haraka redis plugin - Redis plugin","navigation":{"title":"redis"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"redis-plugin"},"children":[{"type":"text","value":"Redis plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Connects to a local (by default) redis instance and stores a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"redis"}]},{"type":"text","value":"\nconnection handle at "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"server.notes.redis"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"config"},"children":[{"type":"text","value":"Config"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"redis.ini"}]},{"type":"text","value":" file has the following sections (defaults shown):"}]},{"type":"element","tag":"h3","props":{"id":"server"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"server"}]}]},{"type":"element","tag":"code","props":{"className":["language-ini"],"code":"; host=127.0.0.1\n; port=6379\n; db=0\n","language":"ini","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"; host=127.0.0.1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"; port=6379\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"; db=0"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"pubsub"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"pubsub"}]}]},{"type":"element","tag":"code","props":{"className":["language-ini"],"code":"; host=127.0.0.1\n; port=6379\n","language":"ini","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"; host=127.0.0.1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"; port=6379"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Publish & Subscribe are DB agnostic and thus have no db setting. If host and port and not defined, they default to the same as "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":" settings."}]},{"type":"element","tag":"h3","props":{"id":"opts"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"opts"}]}]},{"type":"element","tag":"code","props":{"className":["language-undefined"],"code":"; see https://www.npmjs.com/package/redis#overloading\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"; see https://www.npmjs.com/package/redis#overloading"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Use redis in your plugin like so:"}]},{"type":"element","tag":"code","props":{"className":["language-js"],"code":"if (server.notes.redis) {\n    server.notes.redis.hgetall(...);\n        // or any other redis command\n}\n","language":"js","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" (server.notes.redis) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"    server.notes.redis."}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"hgetall"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// or any other redis command\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"publishsubscribe-usage"},"children":[{"type":"text","value":"Publish/Subscribe Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In your plugin:"}]},{"type":"element","tag":"code","props":{"className":["language-js"],"code":"exports.results_init = function (next, connection) {\n    var plugin = this;\n    plugin.redis_subscribe(connection, function () {\n        connection.notes.redis.on('pmessage', function (pattern, channel, message) {\n            plugin.do_something_with_message(message, ...);\n        });\n        next();\n    });\n}\n// be nice to redis and disconnect\nexports.hook_disconnect = function (next, connection) {\n    this.redis_unsubscribe(connection);\n}\n","language":"js","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-484930"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"results_init"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-684589"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-684589"},"children":[{"type":"text","value":"connection"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" plugin "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-484930"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"    plugin."}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"redis_subscribe"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"(connection, "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" () {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"        connection.notes.redis."}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-497092"},"children":[{"type":"text","value":"'pmessage'"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-684589"},"children":[{"type":"text","value":"pattern"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-684589"},"children":[{"type":"text","value":"channel"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-684589"},"children":[{"type":"text","value":"message"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"            plugin."}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"do_something_with_message"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"(message, "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"        });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"    });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// be nice to redis and disconnect\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-484930"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"hook_disconnect"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-684589"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-684589"},"children":[{"type":"text","value":"connection"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-484930"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"redis_unsubscribe"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"(connection);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-086898{color:#6A737D;}\n.dark .ct-135336{color:#F97583;}\n.ct-135336{color:#D73A49;}\n.dark .ct-948368{color:#E1E4E8;}\n.ct-948368{color:#24292E;}\n.dark .ct-970614{color:#B392F0;}\n.ct-970614{color:#6F42C1;}\n.dark .ct-484930{color:#79B8FF;}\n.ct-484930{color:#005CC5;}\n.dark .ct-684589{color:#FFAB70;}\n.ct-684589{color:#E36209;}\n.dark .ct-497092{color:#9ECBFF;}\n.ct-497092{color:#032F62;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"config","depth":2,"text":"Config","children":[{"id":"server","depth":3,"text":"server"},{"id":"pubsub","depth":3,"text":"pubsub"},{"id":"opts","depth":3,"text":"opts"}]},{"id":"usage","depth":2,"text":"Usage"},{"id":"publishsubscribe-usage","depth":2,"text":"Publish/Subscribe Usage"}]}},"_type":"markdown","_id":"content:8.plugins:redis.md","_source":"content","_file":"8.plugins/redis.md","_extension":"md"}