[{"_path":"/plugins/clamd","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"clamd - ClamAV plugin for Haraka","description":"Haraka clamd plugin - ClamAV anti-virus plugin","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"clamd-plugin"},"children":[{"type":"text","value":"clamd plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plug-in implements Anti-Virus scanning with ClamAV using the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"clamd"}]},{"type":"text","value":"\ndaemon."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The plug-in will reject any message that ClamAV considers to be a virus.\nIf an error occurs (e.g. clamd not running or a timeout), the\nmessage will be deferred with a temporary failure."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following options can be defined in clamd.ini;"}]},{"type":"element","tag":"h3","props":{"id":"clamd_socket-default-localhost3310"},"children":[{"type":"text","value":"clamd_socket (default: localhost:3310)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"N.N.N.N:port, "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"ipv6::literal"}]},{"type":"text","value":":port, host:port or /path/to/socket of\nthe clamd daemon."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Multiple hosts can be listed separated by comma, semi-colon or spaces."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If "},{"type":"element","tag":"port","props":{},"children":[]},{"type":"text","value":" is omitted it defaults to 3310."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On connection error or timeout the next host in the list will be tried.\nWhen the host list is exhausted, the message will be deferred with\na temporary failure."}]},{"type":"element","tag":"h3","props":{"id":"randomize_host_order-default-false"},"children":[{"type":"text","value":"randomize_host_order (default: false)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If this is set then the list of hosts with be randomized before a\nconnection is attempted."}]},{"type":"element","tag":"h3","props":{"id":"only_with_attachments-default-false"},"children":[{"type":"text","value":"only_with_attachments                         (default: false)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set this option to only scan messages that contain non-textual\nattachments.  This is a performance optimization, however it will\nprevent ClamAV from detecting threats such as Phishing in plain-text\nor HTML messages."}]},{"type":"element","tag":"h3","props":{"id":"connect_timeout-default-10"},"children":[{"type":"text","value":"connect_timeout                               (default: 10)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Timeout connection to host after this many seconds.  A timeout will\ncause the next host in the list to be tried.  Once all hosts have\nbeen tried then a temporary failure will be returned."}]},{"type":"element","tag":"h3","props":{"id":"timeout-default-30"},"children":[{"type":"text","value":"timeout                                       (default: 30)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Post-connection timeout if there is no activity on the socket after\nthis many seconds.  A timeout will cause the message to be rejected\nwith a tempoary failure."}]},{"type":"element","tag":"h3","props":{"id":"max_size-default-26214400"},"children":[{"type":"text","value":"max_size                                      (default: 26214400)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The maximum size of message that should be sent to clamd in bytes.\nThis option should not be larger than the StreamMaxLength value in\nclamd.conf as clamd will stop scanning once this limit is reached.\nIf the clamd limit is reached the plug-in will log a notice that\nthis has happened and will allow the message though."}]},{"type":"element","tag":"h3","props":{"id":"reject"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"reject"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"An optional reject section can offer control over when to reject connections.\nThe default settings are shown. ClamAV recommends that hits coming from\nSafeBrowsing / Phishing / Heuristics, Potentially Unwanted Applications, and\nUNOFFICIAL be used only for scoring."}]},{"type":"element","tag":"code","props":{"code":"* virus=true\n* error=true\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* virus=true\n* error=true\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following reject options are disabled by default in clamd.conf. With a\ndefault ClamAV install, these will have no effect. When an admin enables in\nclamd.conf, Haraka with then, by default, reject such messages. Adjust these\nsettings to suit."}]},{"type":"element","tag":"code","props":{"code":"* Broken.Executable=true\n* Structured=true\n* Encrypted=true\n* PUA=true\n* OLE2=true\n* Safebrowsing=true\n* UNOFFICIAL=true\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* Broken.Executable=true\n* Structured=true\n* Encrypted=true\n* PUA=true\n* OLE2=true\n* Safebrowsing=true\n* UNOFFICIAL=true\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following options are enabled by default in clamd but ClamAV suggests\nusing them only for scoring."}]},{"type":"element","tag":"code","props":{"code":"* Phishing=false\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"* Phishing=false\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"check"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"check"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The optional check section can allow skipping ClamAV check for remote connection\nmeeting following criteria."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"authenticated"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from authenticated users will be scanned."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"private_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from private IPs will be scanned."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"local_ip"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages from localhost will be scanned."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"relay"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: true"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If true, messages that are to be relayed will be scanned."}]}]},{"type":"element","tag":"h2","props":{"id":"clamdexcludes"},"children":[{"type":"text","value":"clamd.excludes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This file can contain a list of virus name patterns that when matched, are\nnot rejected by this plugin. An X-Haraka-Virus: header will be inserted\ncontaining the virus name. This header can then be used for scoring\nin other plugins."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The format of the file is one pattern per line. Comments are prefixed\nwith #. Matches are case-insensitive."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Patterns are expressed using wildcards (e.g. * and ?) or\nvia regexp by enclosing the pattern in //."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To negate a match (e.g. reject if it matches), prefix the match with !.\nNegative matches are always tested fist."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Example:"}]},{"type":"element","tag":"code","props":{"code":"# Always reject test signatures\n!*.TestSig_*\n# Skip all unofficial signatures\n*.UNOFFICIAL\n# Phishing\nHeuristics.Phishing.*\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# Always reject test signatures\n!*.TestSig_*\n# Skip all unofficial signatures\n*.UNOFFICIAL\n# Phishing\nHeuristics.Phishing.*\n"}]}]}]}]},"navigation":{"title":"clamd"},"_type":"markdown","_id":"content:8.plugins:clamd.md","_source":"content","_file":"8.plugins/clamd.md","_extension":"md"},{"_path":"/plugins/connect.fcrdns","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"connect.fcrdns - Forward Confirmed Reverse DNS plugin for Haraka","description":"Haraka connect.fcrdns plugin - Forward Confirmed Reverse DNS","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"connectfcrdns-plugin"},"children":[{"type":"text","value":"connect.fcrdns plugin"}]},{"type":"element","tag":"h2","props":{"id":"description"},"children":[{"type":"text","value":"DESCRIPTION"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Determine if the SMTP sender has matching forward and reverse DNS."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/FCrDNS","rel":["nofollow"]},"children":[{"type":"text","value":"FCrDNS at wikipedia"}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"USAGE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Other plugins can use FCrDNS results like this:"}]},{"type":"element","tag":"code","props":{"code":"var fcrdns = connection.results.get('connect.fcrdns');\nif (fcrdns) {\n    if (fcrdns.fcrdns) {\n        // they passed, reward them\n    }\n\n    var fails = fcrdns.fail;\n    if (connection.results.has('connect.fcrdns', 'fail', /^is_generic/) {\n        // their IP is in their hostname, unlikely to be MX, penalize\n    }\n}\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"var fcrdns = connection.results.get('connect.fcrdns');\nif (fcrdns) {\n    if (fcrdns.fcrdns) {\n        // they passed, reward them\n    }\n\n    var fails = fcrdns.fail;\n    if (connection.results.has('connect.fcrdns', 'fail', /^is_generic/) {\n        // their IP is in their hostname, unlikely to be MX, penalize\n    }\n}\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"CONFIGURATION"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Edit config/connect.fcrdns.ini"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin honors the whitelisting of IPs as set by the rdns_access plugin.\nFor that to work, rdns_access needs to be listed "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"before"}]},{"type":"text","value":" this plugin in\nconfig/plugins."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"timeout=30"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When performing DNS lookups, time out after this many seconds."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following settings permit control of which test will block connections. To\nmimic the lookup_rdns.strict plugin, set no_rdns=true."}]},{"type":"element","tag":"code","props":{"code":"[reject]\n; reject if the IP address has no PTR record\nno_rdns=false\n\n; reject if the FCrDNS test fails\nno_fcrdns=false\n\n; reject if the PTR points to a hostname without a valid TLD\ninvalid_tld=false\n\n; reject if the rDNS is generic, examples:\n; 1.2.3.4.in.addr.arpa\n; c-67-171-0-90.hsd1.wa.comcast.net\ngeneric_rdns=false\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[reject]\n; reject if the IP address has no PTR record\nno_rdns=false\n\n; reject if the FCrDNS test fails\nno_fcrdns=false\n\n; reject if the PTR points to a hostname without a valid TLD\ninvalid_tld=false\n\n; reject if the rDNS is generic, examples:\n; 1.2.3.4.in.addr.arpa\n; c-67-171-0-90.hsd1.wa.comcast.net\ngeneric_rdns=false\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"anti-spam-effects"},"children":[{"type":"text","value":"ANTI-SPAM EFFECTS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The reverse DNS of zombie PCs in bot nets is out of the bot operators control.\nThis presents a significant hurdle for a large portion of the hosts that\nattempt spam delivery."}]},{"type":"element","tag":"h2","props":{"id":"how-it-works"},"children":[{"type":"text","value":"HOW IT WORKS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"From Wikipedia: "},{"type":"element","tag":"a","props":{"href":"http://en.wikipedia.org/wiki/FCrDNS","rel":["nofollow"]},"children":[{"type":"text","value":"Forward Confirmed Reverse DNS"}]}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"First a reverse DNS lookup (PTR query) is performed on the IP address,\nwhich returns a list of zero or more PTR records."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"For each domain name returned in the PTR query results, a regular\n'forward' DNS lookup (type A or AAAA query) is then performed."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Any A or AAAA records returned by the second query are then compared\nagainst the original IP address. If there is a match, FCrDNS passes."}]}]},{"type":"element","tag":"h2","props":{"id":"iprev"},"children":[{"type":"text","value":"iprev"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The iprev results are added to the Authentication-Results header."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.ietf.org/rfc/rfc1912.txt","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 1912"}]},{"type":"element","tag":"a","props":{"href":"http://www.ietf.org/rfc/rfc5451.txt","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 5451"}]},{"type":"element","tag":"a","props":{"href":"http://tools.ietf.org/html/rfc7001#section-3","rel":["nofollow"]},"children":[{"type":"text","value":"RFC 7001"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"2.6.3.  \"iprev\" Results"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"pass:  The DNS evaluation succeeded, i.e., the \"reverse\" and\n\"forward\" lookup results were returned and were in agreement."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"fail:  The DNS evaluation failed.  In particular, the \"reverse\" and\n\"forward\" lookups each produced results, but they were not in\nagreement, or the \"forward\" query completed but produced no\nresult, e.g., a DNS RCODE of 3, commonly known as NXDOMAIN, or an\nRCODE of 0 (NOERROR) in a reply containing no answers, was\nreturned."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"temperror:  The DNS evaluation could not be completed due to some\nerror that is likely transient in nature, such as a temporary DNS\nerror, e.g., a DNS RCODE of 2, commonly known as SERVFAIL, or\nother error condition resulted.  A later attempt may produce a\nfinal result."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"permerror:  The DNS evaluation could not be completed because no PTR\ndata are published for the connecting IP address, e.g., a DNS\nRCODE of 3, commonly known as NXDOMAIN, or an RCODE of 0 (NOERROR)\nin a reply containing no answers, was returned.  This prevented\ncompletion of the evaluation.  A later attempt is unlikely to\nproduce a final result."}]}]},"navigation":{"title":"connect.fcrdns"},"_type":"markdown","_id":"content:8.plugins:connect.fcrdns.md","_source":"content","_file":"8.plugins/connect.fcrdns.md","_extension":"md"}]