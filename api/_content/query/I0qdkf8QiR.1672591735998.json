[{"_path":"/plugins/messagesniffer","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"messagesniffer - Message Sniffer plugin for Haraka","description":"Haraka messagesniffer plugin - Message Sniffer","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"messagesniffer-plugin"},"children":[{"type":"text","value":"messagesniffer plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin provides integration with the commerical Anti-Spam product "},{"type":"element","tag":"a","props":{"href":"http://armresearch.com/products/sniffer.jsp","rel":["nofollow"]},"children":[{"type":"text","value":"MessageSniffer"}]},{"type":"text","value":" by Arm Research Labs using its XML Client interface "},{"type":"element","tag":"a","props":{"href":"http://armresearch.com/support/articles/software/snfServer/xci/","rel":["nofollow"]},"children":[{"type":"text","value":"XCI"}]},{"type":"text","value":" over TCP."}]},{"type":"element","tag":"h2","props":{"id":"installation"},"children":[{"type":"text","value":"Installation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install the SNF Client/Server package for your platform as per the instructions on the MessageSniffer website."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Modify your SNFServer.xml file and under the 'xheaders' section set:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"output mode='api'"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This prevents MessageSniffer from adding additional headers to the temporary file used to send it the message data which is\nunnecessary as Haraka reads the headers from the XCI response."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rulebase on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"result on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"black on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"while on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"clean on-off='on'"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"all symbol on-off='on'"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These cause SNFServer to send Haraka additional headers that are inserted into all messages scanned by MessageSniffer and\nwill aid debugging and troubleshooting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once this is done start/restart the SNF server."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"messagesniffer.ini"}]},{"type":"text","value":" for configuration.  The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[main]"}]},{"type":"text","value":" section is for global configuration, the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[gbudb]"}]},{"type":"text","value":"\nsection is used to specify the action that should be taken based on the GBUdb result which is checked at the start of the\nconnection and the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[message]"}]},{"type":"text","value":" section is used to specify the action to be taken based on the main scan result."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[main]"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"port"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: 9001\nTCP port to use when communicating to the SNFServer daemon.\nThis needs to match the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"<xci on-off='on' port='9001'/>"}]},{"type":"text","value":" value in the SNFServer.xml file."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"tmpdir"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: /tmp\nTemporary directory used to write temporary message files to that are read by the SNFServer daemon.\nThis directory and the files within need to be readable by the user that SNFServer is running as."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"gbudb_report_deny = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" true | false | 0 | 1"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: false\nThis is an experimental option that will record a GBUdb 'bad' encounter for a connected IP address when a client\ndisconnects with no message having been sent or seen by MessageSniffer but Haraka has recorded a hard rejection at\nsome point during the session.  The idea behind this option is that it allows other Haraka plugins rejections influence\nGBUdb IP reputation where MessageSniffer isn't seeing the actual message because it is being rejected pre-DATA."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"tag_string"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"SPAM"}]},{"type":"text","value":"\nString to prepend to the Subject line if the 'tag' action is applied."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[gbudb]"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"white = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: accept\nAction to take when GBUdb reports a 'white' result."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"caution = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when GBUdb reports a 'caution' result."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"black = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when GBUdb reports a 'black' result."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"truncate = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: reject\nAction to take when GBUdb reports a 'truncate' result."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[message]"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"white = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when MessageSniffer reports a 'white' result (result code: 0)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"local_white = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: accept\nAction to take when MessageSniffer reports a local whitelist result (result code: 1).\nNOTE: You will not see this result unless you Arm support have customized your rulebase and added white rules for you."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"truncate = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: reject\nAction to take when MessageSniffer reports a GBUdb result of 'truncate' (result code: 20).\nNOTE: GBUdb IP lookups during the data phase can be different than the connecting IP address if you have configured\nSource and DrillDown options in the Training section of SNFServer.xml."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"caution = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when MessageSniffer reports a GBUdb result of 'caution' (result code: 40).\nNOTE: GBUdb IP lookups during the data phase can be different than the connecting IP address if you have configured\nSource and DrillDown options in the Training section of SNFServer.xml."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"black = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Default: continue\nAction to take when MessageSniffer reports a GBUdb result of 'black' (result code: 63).\nNOTE: GBUdb IP lookups during the data phase can be different than the connecting IP address if you have configured\nSource and DrillDown options in the Training section of SNFServer.xml."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"code_NN = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"NOTE: replace NN with the numeric MessageSniffer "},{"type":"element","tag":"a","props":{"href":"http://armresearch.com/support/articles/software/snfServer/core.jsp","rel":["nofollow"]},"children":[{"type":"text","value":"result code"}]},{"type":"text","value":"\nAction to take when MessageSniffer reports a result code other than those explicitly defined above."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"nonzero = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" accept | allow | continue | retry | tempfail | reject | quarantine | tag"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Defalt: reject\nAction to take for any non-zero result code other than those explicity defined above.  This is a catch-all result that\nis checked last after all other settings have been checked so you can define a code_NN value to prevent this action from\nbeing taken."}]}]},{"type":"element","tag":"h2","props":{"id":"actions"},"children":[{"type":"text","value":"Actions"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"accept"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Accept the message and skip further plugins (whitelist)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"allow | continute"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Continue to the next plugin."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"retry | tempfail"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Reject the message with a temporary failure message (DENYSOFT)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Reject the message with a permanent failure message (DENY)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"quarantine"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Continue to the next plugin.  If the message isn't rejected by another plugin - it will cause the message to be quarantined\nand the message will not be delivered to the recipient(s)."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"NOTE: this option requires the queue/quarantine plugin in your config/plugins files and it must be listed before any\nother queue plugins."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"tag"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Tag the subject with the default 'tag_string' defined in the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"main"}]},{"type":"text","value":" section above, this will also set X-Spam-Flag: YES in\nthe message headers.   Once tagged, processing will continue to the next plugin."}]}]}]},"navigation":{"title":"messagesniffer"},"_type":"markdown","_id":"content:8.plugins:messagesniffer.md","_source":"content","_file":"8.plugins/messagesniffer.md","_extension":"md"},{"_path":"/plugins/process_title","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"process_title - Process title plugin for Haraka","description":"Haraka process_title plugin - Set the process title","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"process_title-plugin"},"children":[{"type":"text","value":"process_title plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin causes the process title seen by the UNIX 'ps' command to\nbe modified from this:"}]},{"type":"element","tag":"code","props":{"code":"node haraka.js -c /etc/haraka\n","language":"sh"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"node haraka.js -c /etc/haraka\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"to this:"}]},{"type":"element","tag":"code","props":{"code":"Haraka (master) cn=11148 cc=1082 cps=21/25.24/79 rcpts=144950/1.84 rps=518/328.18/586 msgs=78815/7.07 mps=302/178.44/329 out=0/0/0 respawn=0 \n \\_ Haraka (worker) cn=1646 cc=140 cps=5/3.73/17 rcpts=20310/1.86 rps=75/46.04/102 msgs=10938/6.65 mps=42/24.8/56 out=0/0/0 \n \\_ Haraka (worker) cn=1563 cc=168 cps=3/3.54/18 rcpts=19844/1.87 rps=78/45/96 msgs=10627/6.8 mps=49/24.1/53 out=0/0/0 \n \\_ Haraka (worker) cn=1852 cc=172 cps=3/4.2/16 rcpts=26278/2.03 rps=93/59.56/114 msgs=12938/6.99 mps=40/29.33/65 out=0/0/0 \n \\_ Haraka (worker) cn=1704 cc=187 cps=5/3.86/14 rcpts=23688/1.84 rps=93/53.7/125 msgs=12886/7.56 mps=64/29.21/66 out=0/0/0 \n \\_ Haraka (worker) cn=2296 cc=218 cps=2/5.2/20 rcpts=29300/1.78 rps=117/66.4/125 msgs=16489/7.18 mps=40/37.37/66 out=0/0/0 \n \\_ Haraka (worker) cn=2091 cc=195 cps=4/4.74/16 rcpts=25646/1.71 rps=84/58.12/117 msgs=14982/7.16 mps=52/33.95/66 out=0/0/0 \n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"Haraka (master) cn=11148 cc=1082 cps=21/25.24/79 rcpts=144950/1.84 rps=518/328.18/586 msgs=78815/7.07 mps=302/178.44/329 out=0/0/0 respawn=0 \n \\_ Haraka (worker) cn=1646 cc=140 cps=5/3.73/17 rcpts=20310/1.86 rps=75/46.04/102 msgs=10938/6.65 mps=42/24.8/56 out=0/0/0 \n \\_ Haraka (worker) cn=1563 cc=168 cps=3/3.54/18 rcpts=19844/1.87 rps=78/45/96 msgs=10627/6.8 mps=49/24.1/53 out=0/0/0 \n \\_ Haraka (worker) cn=1852 cc=172 cps=3/4.2/16 rcpts=26278/2.03 rps=93/59.56/114 msgs=12938/6.99 mps=40/29.33/65 out=0/0/0 \n \\_ Haraka (worker) cn=1704 cc=187 cps=5/3.86/14 rcpts=23688/1.84 rps=93/53.7/125 msgs=12886/7.56 mps=64/29.21/66 out=0/0/0 \n \\_ Haraka (worker) cn=2296 cc=218 cps=2/5.2/20 rcpts=29300/1.78 rps=117/66.4/125 msgs=16489/7.18 mps=40/37.37/66 out=0/0/0 \n \\_ Haraka (worker) cn=2091 cc=195 cps=4/4.74/16 rcpts=25646/1.71 rps=84/58.12/117 msgs=14982/7.16 mps=52/33.95/66 out=0/0/0 \n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"where:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"cn = Total number of connections"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"cc = Total number of concurrent connections"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"cps = Number of connections in the last second / average / maximum"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rcpts = Total number of recipients / Average number of recipients per message"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"rps = Number of recipients in the last second / average / maximum"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"msgs = Total number of messages / Average number messages per connection"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"mps = Number of messages in the last second / average / maximum"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"out = Mails being processed / Mails waiting to be processed / Mails in temp fail state"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"respawn = Number of worker processes respawned (only under cluster)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If 'cluster' is used then the master process will show the total\nacross all workers, with the exception of outbound stats."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All of the counts shown are since the process started, so if a\nworker has been re-started then the counts may not add up."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: this plugin will only work on node >= 0.8 and should be\nadded at the top of config/plugins to ensure that it functions\ncorrectly."}]}]},"navigation":{"title":"process_title"},"_type":"markdown","_id":"content:8.plugins:process_title.md","_source":"content","_file":"8.plugins/process_title.md","_extension":"md"}]