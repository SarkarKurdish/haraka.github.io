{"_path":"/plugins/redis","_dir":"plugins","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"redis - Redis plugin","description":"Haraka redis plugin - Redis plugin","navigation":{"title":"redis"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"redis-plugin"},"children":[{"type":"text","value":"Redis plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Connects to a local (by default) redis instance and stores a "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"redis"}]},{"type":"text","value":"\nconnection handle at "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"server.notes.redis"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"config"},"children":[{"type":"text","value":"Config"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"redis.ini"}]},{"type":"text","value":" file has the following sections (defaults shown):"}]},{"type":"element","tag":"h3","props":{"id":"server"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"server"}]}]},{"type":"element","tag":"code","props":{"code":"; host=127.0.0.1\n; port=6379\n; db=0\n","language":"ini","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-46591e"},"children":[{"type":"text","value":"; host=127.0.0.1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-46591e"},"children":[{"type":"text","value":"; port=6379\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-46591e"},"children":[{"type":"text","value":"; db=0"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"pubsub"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"pubsub"}]}]},{"type":"element","tag":"code","props":{"code":"; host=127.0.0.1\n; port=6379\n","language":"ini","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-46591e"},"children":[{"type":"text","value":"; host=127.0.0.1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-46591e"},"children":[{"type":"text","value":"; port=6379"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Publish & Subscribe are DB agnostic and thus have no db setting. If host and port and not defined, they default to the same as "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"server"}]},{"type":"text","value":" settings."}]},{"type":"element","tag":"h3","props":{"id":"opts"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"opts"}]}]},{"type":"element","tag":"code","props":{"code":"; see https://www.npmjs.com/package/redis#overloading\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"; see https://www.npmjs.com/package/redis#overloading"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Use redis in your plugin like so:"}]},{"type":"element","tag":"code","props":{"code":"if (server.notes.redis) {\n    server.notes.redis.hgetall(...);\n        // or any other redis command\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-c48b8b"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":" (server.notes.redis) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"    server.notes.redis."}]},{"type":"element","tag":"span","props":{"class":"ct-3bab0c"},"children":[{"type":"text","value":"hgetall"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-c48b8b"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-46591e"},"children":[{"type":"text","value":"// or any other redis command\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"publishsubscribe-usage"},"children":[{"type":"text","value":"Publish/Subscribe Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In your plugin:"}]},{"type":"element","tag":"code","props":{"code":"exports.results_init = function (next, connection) {\n    var plugin = this;\n    plugin.redis_subscribe(connection, function () {\n        connection.notes.redis.on('pmessage', function (pattern, channel, message) {\n            plugin.do_something_with_message(message, ...);\n        });\n        next();\n    });\n}\n// be nice to redis and disconnect\nexports.hook_disconnect = function (next, connection) {\n    this.redis_unsubscribe(connection);\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-9dc780"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3bab0c"},"children":[{"type":"text","value":"results_init"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c48b8b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c48b8b"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-2c59f3"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-2c59f3"},"children":[{"type":"text","value":"connection"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-c48b8b"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":" plugin "}]},{"type":"element","tag":"span","props":{"class":"ct-c48b8b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9dc780"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"    plugin."}]},{"type":"element","tag":"span","props":{"class":"ct-3bab0c"},"children":[{"type":"text","value":"redis_subscribe"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"(connection, "}]},{"type":"element","tag":"span","props":{"class":"ct-c48b8b"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":" () {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"        connection.notes.redis."}]},{"type":"element","tag":"span","props":{"class":"ct-3bab0c"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-354851"},"children":[{"type":"text","value":"'pmessage'"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-c48b8b"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-2c59f3"},"children":[{"type":"text","value":"pattern"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-2c59f3"},"children":[{"type":"text","value":"channel"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-2c59f3"},"children":[{"type":"text","value":"message"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"            plugin."}]},{"type":"element","tag":"span","props":{"class":"ct-3bab0c"},"children":[{"type":"text","value":"do_something_with_message"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"(message, "}]},{"type":"element","tag":"span","props":{"class":"ct-c48b8b"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"        });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-3bab0c"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"    });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-46591e"},"children":[{"type":"text","value":"// be nice to redis and disconnect\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-9dc780"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3bab0c"},"children":[{"type":"text","value":"hook_disconnect"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c48b8b"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c48b8b"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-2c59f3"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-2c59f3"},"children":[{"type":"text","value":"connection"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-9dc780"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3bab0c"},"children":[{"type":"text","value":"redis_unsubscribe"}]},{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"(connection);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-c0b89e"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-354851{color:#0A3069}\n.ct-2c59f3{color:#953800}\n.ct-9dc780{color:#0550AE}\n.ct-3bab0c{color:#8250DF}\n.ct-c0b89e{color:#24292F}\n.ct-c48b8b{color:#CF222E}\n.ct-46591e{color:#6E7781}\n.dark .ct-46591e{color:#8B949E}\n.dark .ct-c48b8b{color:#FF7B72}\n.dark .ct-c0b89e{color:#C9D1D9}\n.dark .ct-3bab0c{color:#D2A8FF}\n.dark .ct-9dc780{color:#79C0FF}\n.dark .ct-2c59f3{color:#FFA657}\n.dark .ct-354851{color:#A5D6FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"config","depth":2,"text":"Config","children":[{"id":"server","depth":3,"text":"server"},{"id":"pubsub","depth":3,"text":"pubsub"},{"id":"opts","depth":3,"text":"opts"}]},{"id":"usage","depth":2,"text":"Usage"},{"id":"publishsubscribe-usage","depth":2,"text":"Publish/Subscribe Usage"}]}},"_type":"markdown","_id":"content:8.plugins:redis.md","_source":"content","_file":"8.plugins/redis.md","_extension":"md"}