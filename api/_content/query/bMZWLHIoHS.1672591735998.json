[{"_path":"/plugins/connect.geoip","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"geoip - GeoIP lookup","description":"Haraka geoip plugin - GeoIP lookup","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"geoip-plugin"},"children":[{"type":"text","value":"geoip plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"provide geographic information about mail senders."}]},{"type":"element","tag":"h1","props":{"id":"synopsis"},"children":[{"type":"text","value":"SYNOPSIS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Use MaxMind's GeoIP databases to report geographic information about senders. This plugin has support for both the "},{"type":"element","tag":"a","props":{"href":"https://github.com/runk/node-maxmind","rel":["nofollow"]},"children":[{"type":"text","value":"maxmind"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"https://github.com/bluesmoon/node-geoip","rel":["nofollow"]},"children":[{"type":"text","value":"geoip-lite"}]},{"type":"text","value":" node modules."}]},{"type":"element","tag":"h1","props":{"id":"install"},"children":[{"type":"text","value":"INSTALL"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install the npm geoip module you prefer:"}]},{"type":"element","tag":"code","props":{"code":"npm install maxmind\n  or\nnpm install -g geoip-lite\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"npm install maxmind\n  or\nnpm install -g geoip-lite\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If both are installed, maxmind will be preferred as it's faster and also provides ASN data. The maxmind module requires manual download of the GeoIP databases. The npm module "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"maxmind-geolite-mirror"}]},{"type":"text","value":" will download the files and keep them up-to-date if you run it periodically."}]},{"type":"element","tag":"code","props":{"code":"mkdir -p /usr/local/share/GeoIP\nnpm install -g maxmind-geolite-mirror\n/usr/local/bin/maxmind-geolite-mirror\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"mkdir -p /usr/local/share/GeoIP\nnpm install -g maxmind-geolite-mirror\n/usr/local/bin/maxmind-geolite-mirror\n"}]}]}]},{"type":"element","tag":"h1","props":{"id":"description"},"children":[{"type":"text","value":"DESCRIPTION"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"GeoIP results are stored in connection.notes.geoip and connection."},{"type":"element","tag":"a","props":{"href":"https://github.com/haraka/Haraka/blob/master/docs/Results.md","rel":["nofollow"]},"children":[{"type":"text","value":"results"}]},{"type":"text","value":" .connect.geoip. The following information is typically available:"}]},{"type":"element","tag":"code","props":{"code":"continent: NA,\ncountry:   US,\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"continent: NA,\ncountry:   US,\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the GeoIP city database is available, the following may also be available:"}]},{"type":"element","tag":"code","props":{"code":"region:   CA,\ncity:     San Francisco,\nll:       [37.7484, -122.4156],\ndistance: 1539    // in kilometers\nrange:    [ 3479299040, 3479299071 ],\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"region:   CA,\ncity:     San Francisco,\nll:       [37.7484, -122.4156],\ndistance: 1539    // in kilometers\nrange:    [ 3479299040, 3479299071 ],\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"connect.geoip"}]},{"type":"text","value":" also adds entries like this to your logs:"}]},{"type":"element","tag":"code","props":{"code":"[connect.geoip] US\n[connect.geoip] US, WA\n[connect.geoip] US, WA, Seattle\n[connect.geoip] US, WA, Seattle, 1319km\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[connect.geoip] US\n[connect.geoip] US, WA\n[connect.geoip] US, WA, Seattle\n[connect.geoip] US, WA, Seattle, 1319km\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Calculating the distance requires the public IP of this mail server. This may\nbe the IP that Haraka is bound to. If not, make sure that "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"utils.get_public_ip"}]},{"type":"text","value":"\ncan figure it out (via STUN or in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"smtp.ini"}]},{"type":"text","value":")."}]},{"type":"element","tag":"h1","props":{"id":"config"},"children":[{"type":"text","value":"CONFIG"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"distance"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Perform the geodesic distance calculations. Calculates the distance \"as the\ncrow flies\" from the remote mail server."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This calculation requires a 'from' IP address. This will typically be the\npublic IP of your mail server. If Haraka is bound to a private IP, net_utils\nwill attempt to determine your public IP. If that doesn't work, edit\nconfig/smtp.ini and set "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"public_ip"}]},{"type":"text","value":"."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"show_city"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"show city data in logs and headers. City data is less accurate than country."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"show_region in logs and headers. Regional data are US states, Canadian\nprovinces and such."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set a connection result to true if the distance exceeds this many kilometers."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"too_far=4000"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"asn"}]},{"type":"text","value":"report_as"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Permits reporting the ASN as another plugin (such as connect.asn)."}]},{"type":"element","tag":"h1","props":{"id":"spam-prediction-with-distance"},"children":[{"type":"text","value":"SPAM PREDICTION WITH DISTANCE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.cc.gatech.edu/~feamster/papers/snare-usenix09.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"Spatio-temporal Network-level Automatic Reputation Engine"}]}]},{"type":"element","tag":"code","props":{"code":"\"For ham, 90% of the messages travel about 4,000 km or less. On the\nother hand, for spam, only 28% of messages stay within this range.\"\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"\"For ham, 90% of the messages travel about 4,000 km or less. On the\nother hand, for spam, only 28% of messages stay within this range.\"\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Observations in 2014 suggest that geodesic distance continues to be an\nexcellent predictor of spam."}]},{"type":"element","tag":"h1","props":{"id":"limitations"},"children":[{"type":"text","value":"LIMITATIONS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The distance calculations are more concerned with being fast than\naccurate. The MaxMind location data is collected from whois and is of\nlimited accuracy. MaxMind offers more accurate data for a fee."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For distance calculations, the earth is considered a perfect sphere. In\nreality, it is not. Accuracy should be within 1%."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin does not update the GeoIP databases. You may want to."}]},{"type":"element","tag":"h1","props":{"id":"see-also"},"children":[{"type":"text","value":"SEE ALSO"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"MaxMind: "},{"type":"element","tag":"a","props":{"href":"http://www.maxmind.com/","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.maxmind.com/"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Databases: "},{"type":"element","tag":"a","props":{"href":"http://geolite.maxmind.com/download/geoip/database","rel":["nofollow"]},"children":[{"type":"text","value":"http://geolite.maxmind.com/download/geoip/database"}]}]},{"type":"element","tag":"h1","props":{"id":"todo"},"children":[{"type":"text","value":"TODO"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Keep an eye on node-geoip and see if they add ASN support. This would be an\nalternative to connect.asn which uses a DNS lookup to retrieve the ASN."}]}]},"navigation":{"title":"geoip"},"_type":"markdown","_id":"content:8.plugins:connect.geoip.md","_source":"content","_file":"8.plugins/connect.geoip.md","_extension":"md"},{"_path":"/plugins/connect.rdns_access","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"connect.rdns_access - Reverse DNS Access Control plugin for Haraka","description":"Haraka connect.rdns_access plugin - Reverse DNS Access Control","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"connectrdns_access-plugin"},"children":[{"type":"text","value":"connect.rdns_access plugin"}]},{"type":"element","tag":"h2","props":{"id":"deprecation-notice"},"children":[{"type":"text","value":"DEPRECATION NOTICE"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See the "},{"type":"element","tag":"a","props":{"href":"/plugins/access"},"children":[{"type":"text","value":"access"}]},{"type":"text","value":" plugin for upgrade instructions."}]},{"type":"element","tag":"h1","props":{"id":"connectrdns_access"},"children":[{"type":"text","value":"connect.rdns_access"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will evaluate the remote IP address and the remote rDNS hostname\nagainst a set of white and black lists.  The lists are applied in the following\nway:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"connect.rdns_access.whitelist         (pass)\nconnect.rdns_access.whitelist_regex   (pass)\nconnect.rdns_access.blacklist         (block)\nconnect.rdns_access.blacklist_regex   (block)"}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accessini"},"children":[{"type":"text","value":"Configuration connect.rdns_access.ini"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"General configuration file for this plugin."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"connect.rdns_access.general.deny_msg"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Text to send the user on reject (text)."}]}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accesswhitelist"},"children":[{"type":"text","value":"Configuration connect.rdns_access.whitelist"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The whitelist is mostly to counter blacklist entries that match more than\nwhat one would want.  This file should be used for a specific IP address\nor rDNS hostnames, one per line, that should bypass blacklist checks.\nNOTE: We heavily suggest tailoring blacklist entries to be as accurate as\npossible and never using whitelists.  Nevertheless, if you need whitelists,\nhere they are."}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accesswhitelist_regex"},"children":[{"type":"text","value":"Configuration connect.rdns_access.whitelist_regex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Does the same thing as the whitelist file, but each line is a regex.\nEach line is also anchored for you, meaning '^' + regex + '$' is added for\nyou.  If you need to get around this restriction, you may use a '.*' at\neither the start or the end of your regex.  This should help prevent people\nfrom writing overly permissive rules on accident."}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accessblacklist"},"children":[{"type":"text","value":"Configuration connect.rdns_access.blacklist"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This file should be used for a specific IP address or rDNS hostnames, one\nper line, that should fail on connect."}]},{"type":"element","tag":"h2","props":{"id":"configuration-connectrdns_accessblacklist_regex"},"children":[{"type":"text","value":"Configuration connect.rdns_access.blacklist_regex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Does the same thing as the blacklist file, but each line is a regex.\nEach line is also anchored for you, meaning '^' + regex + '$' is added for\nyou.  If you need to get around this restriction, you may use a '.*' at\neither the start or the end of your regex.  This should help prevent people\nfrom writing overly permissive rules on accident."}]}]},"navigation":{"title":"connect.rdns_access"},"_type":"markdown","_id":"content:8.plugins:connect.rdns_access.md","_source":"content","_file":"8.plugins/connect.rdns_access.md","_extension":"md"}]