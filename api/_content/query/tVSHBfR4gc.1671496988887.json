[{"_path":"/plugins/dkim_sign","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"dkim_sign - DKIM Sign plugin for Haraka","description":"Haraka dkim_sign plugin - DKIM Sign","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dkim_sign-plugin"},"children":[{"type":"text","value":"dkim_sign plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin implements the DKIM Core specification found at dkimcore.org"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"DKIM Core is a simplified subset of DKIM which is easier to understand\nand deploy, yet provides all the same delivery advantages as DKIM."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin can only "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"sign"}]},{"type":"text","value":" outbound messages.  It does not validate\nDKIM signatures."}]},{"type":"element","tag":"h2","props":{"id":"getting-started"},"children":[{"type":"text","value":"Getting Started"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Generate DKIM selector and keys:"}]},{"type":"element","tag":"code","props":{"code":"% cd /path/to/haraka/config/dkim\n./dkim_key_gen.sh example.org\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"% cd /path/to/haraka/config/dkim\n./dkim_key_gen.sh example.org\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Peek into the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim_key_gen.sh"}]},{"type":"text","value":" shell script to see the commands used to\ncreate and format the DKIM public key. Within the config/dkim/example.org\ndirectory will be 4 files:"}]},{"type":"element","tag":"code","props":{"code":"% ls config/dkim/example.org/\ndns private public selector\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"% ls config/dkim/example.org/\ndns private public selector\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" files contain the DKIM keys, the selector is\nin the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"selector"}]},{"type":"text","value":" file and the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dns"}]},{"type":"text","value":" file contains a formatted record of\nthe public key, as well as suggestions for DKIM, SPF, and DMARC policy\nrecords. The records in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dns"}]},{"type":"text","value":" are ready to be copy/pasted into the DNS\nzone for example.org."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The DKIM DNS record will look like this:"}]},{"type":"element","tag":"code","props":{"code":"may2013._domainkey TXT \"v=DKIM1;p=[public key stripped of whitespace];\"\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"may2013._domainkey TXT \"v=DKIM1;p=[public key stripped of whitespace];\"\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And the values in the address have the following meaning:"}]},{"type":"element","tag":"code","props":{"code":"hash: h=[ sha1 | sha256 ]\ntest; t=[ s | s:y ]\ngranularity: g=[ ]\nnotes: n=[ ]\nservices: s=[email]\nkeytypes: [ rsa ]\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"hash: h=[ sha1 | sha256 ]\ntest; t=[ s | s:y ]\ngranularity: g=[ ]\nnotes: n=[ ]\nservices: s=[email]\nkeytypes: [ rsa ]\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"key-size"},"children":[{"type":"text","value":"Key size"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The default key size created by "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim_key_gen.sh"}]},{"type":"text","value":" is 2048. As of mid-2014, there are some DNS providers that do not support key sizes that long."}]},{"type":"element","tag":"h1","props":{"id":"what-to-sign"},"children":[{"type":"text","value":"What to sign"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The DKIM signing key for messages from example.org "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"should"}]},{"type":"text","value":" be signed with\na DKIM key for example.org. Failing to do so will result in messages not\nhaving an "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"aligned"}]},{"type":"text","value":" DKIM signature. For DMARC enabled domains, this will\nlikely result in deliverability problems."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For correct alignment, Haraka signs each message with that domains DKIM key.\nFor an alternative, see the legacy Single Domain Configuration below."}]},{"type":"element","tag":"h1","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin uses the configuration "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim_sign.ini"}]},{"type":"text","value":" in INI format.\nAll configuration should appear within the 'main' block and is\nchecked for updates on every run."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"disabled = "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":" 1 | true | yes"}]},{"type":"text","value":"             (OPTIONAL)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to disable DKIM signing"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"headers_to_sign = list, of; headers       (REQUIRED)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to the list of headers that should be signed\nseparated by either a comma, colon or semi-colon.\nThis is to prevent any tampering of the specified headers.\nThe 'From' header is required to be present by the RFC and\nwill be added if it is missing."}]}]},{"type":"element","tag":"h2","props":{"id":"single-domain-configuration"},"children":[{"type":"text","value":"Single Domain Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To sign all messages with a single DKIM key, these two config settings\nare required."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"selector = name"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to the selector name published in DNS under the\n_domainkey sub-domain of the domain referenced below."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"domain = name"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Set this to the domain name that will be used to sign messages\nwhich don't match a per-domain DKIM key.  The DNS TXT entry for:"},{"type":"element","tag":"code","props":{"code":"  <selector>._domainkey.<domain>\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"  <selector>._domainkey.<domain>\n"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"dkim.private.key = filename"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Create a file "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dkim.private.key"}]},{"type":"text","value":" in the config folder and paste\nyour private key in it."}]}]}]},"navigation":{"title":"dkim_sign"},"_type":"markdown","_id":"content:8.plugins:dkim_sign.md","_source":"content","_file":"8.plugins/dkim_sign.md","_extension":"md"},{"_path":"/plugins/dnsbl","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"dnsbl - DNS Blacklists plugin for Haraka","description":"Haraka dnsbl plugin - DNS Blacklists","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"dnsbl-plugin"},"children":[{"type":"text","value":"dnsbl plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin looks up the connecting IP address in an IP blocklist. Mails\nfound to be in the blocklist are rejected."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugins uses the following files:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"dnsbl.zones - Contains a list of zones to query, one per line."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"dnsbl.ini - INI format with options described below:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"zones"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"A comma or semi-colon list of zones to query.  It will be merged with\nany lists in dnsbl.zones."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"periodic_checks"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"If enabled, this will check all the zones every n minutes.\nThe minimum value that will be accepted here is 5.  Any value less\nthan 5 will cause the checks to be run at start-up only."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The checks confirm that the list is responding and that it is not\nlisting the world.  If any errors are detected, then the zone is\ndisabled and will be re-checked on the next test.  If a zone\nsubsequently starts working correctly then it will be re-enabled."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"enable_stats"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"To use this feature you must have installed the 'redis' module and\nhave a redis server running."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"When enabled, this will record several list statistics to redis."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"It will track the total number of queries (TOTAL) and the average\nresponse time (AVG_RT) and the return type (e.g. LISTED or ERROR)\nto a redis hash where the key is 'dns-list-stat:zone' and the hash\nfield is the response type."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"It will also track the positive response overlap between the lists\nin another redis hash where the key is 'dns-list-overlap:zone' and\nthe hash field is the other list names."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Example:"},{"type":"text","value":"  "},{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"redis 127.0.0.1:6379> hgetall dns-list-stat:zen.spamhaus.org\n  1) \"TOTAL\"\n  2) \"23\"\n  3) \"ENOTFOUND\"\n  4) \"11\"\n  5) \"LISTED\"\n  6) \"12\"\n  7) \"AVG_RT\"\n  8) \"45.5\"\n  redis 127.0.0.1:6379> hgetall dns-list-overlap:zen.spamhaus.org\n  1) \"b.barracudacentral.org\"\n  2) \"1\"\n  3) \"bl.spamcop.net\"\n  4) \"1\"\n  5) \"TOTAL\"\n  6) \"1\"\n  "}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"stats_redis_host"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"In the form of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"host:port"}]},{"type":"text","value":" this option allows you to specify a different\nhost on which redis runs."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"reject (default: true)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Reject connections from IPs that are blacklisted. Setting this to false\nmakes dnsbl informational. reject=false is best used in conjunction with\nplugins like "},{"type":"element","tag":"a","props":{"href":"/plugins/karma"},"children":[{"type":"text","value":"karma"}]},{"type":"text","value":" that employ a scoring\nengine to make choices about message delivery."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"search: (default: first)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"first: consider first DNSBL response conclusive. End processing.\nall:   process all DNSBL results"}]}]}]},"navigation":{"title":"dnsbl"},"_type":"markdown","_id":"content:8.plugins:dnsbl.md","_source":"content","_file":"8.plugins/dnsbl.md","_extension":"md"}]