{"_path":"/plugins/queue/quarantine","_dir":"queue","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"quarantine - Quarantine mail","description":"Haraka quarantine plugin - Quarantine mail","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"quarantine-plugin"},"children":[{"type":"text","value":"quarantine plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will save a message (in message/rfc822 format) to a specified\ndirectory, which will be created automatically if it does not already exist,\na dated sub-folder is also added to the end of the path specified in YYYYMMDD\nformat."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is designed to be used by other plugins which request the message be\nquarantined by setting a connection or transaction note that this plugin\nchecks."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"NOTE: this plugin simply saves a copy of the message.  It does not reject or\ndiscard the message and relies on another plugin to perform this function."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It uses the 'queue' hook, so that it runs after all the 'data_post' plugins\nand should be listed in 'config/plugins' to run before your queue hooks that\nperform actual deliveries."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To ensure that only completely written files are present in the quarantine,\nthe files are written to a temporary directory first and then hardlinked to\nthe final destination before the temporary file is deleted."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The temporary directory is 'quarantine_path/tmp' which defaults to:\n/var/spool/haraka/quarantine/tmp."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Upon start-up, any files present in the temporary directory are deleted\nsyncronously prior to any messages being accepted."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin looks for 'quarantine.ini' in the config directory."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"quarantine_path                   (default: /var/spool/haraka/quarantine)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The default base path to save the quarantine files to.  It will be created\nif it does not already exist."}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you wish to keep a copy of the message in your plugin, simply either:"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine = [ 1 | true | 'sub/directory/path' ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.notes.quarantine = [ 1 | true | 'sub/directory/path' ];\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"or"}]},{"type":"element","tag":"code","props":{"code":"connection.transaction.notes.quarantine = [ 1 | true | 'sub/directory/path' ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.transaction.notes.quarantine = [ 1 | true | 'sub/directory/path' ];\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"e.g."}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine = 1;\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.notes.quarantine = 1;\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"would save the message to '/var/spool/quarantine/haraka/YYYYMMDD/UUID' where\nYYYMMDD and UUID are expanded to current date and transaction UUID."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"and"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine = 'corpus';\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.notes.quarantine = 'corpus';\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"would save the message to '/var/spool/quarantine/haraka/corpus/YYYYMMDD/UUID'."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: you can specify 'corpus/foo' or 'corpus/foo/bar' and the directories will\nbe automatically created.  Do not add any leading or trailing slashes."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default - after the message is quarantined, the plugin will tell Haraka to\ncontinue to the next plugin.  You can specify a different action like DENY or\nOK and supply an optional message using the following notes:"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine_action = [ OK, 'Message quarantined' ];\nconnection.transaction.notes.quarantine_action = [ DENY, 'Message rejected' ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.notes.quarantine_action = [ OK, 'Message quarantined' ];\nconnection.transaction.notes.quarantine_action = [ DENY, 'Message rejected' ];\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you don't want to supply a specific message back to the client you can\nalso just specify a return code:"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine_action = OK;\nconnection.transaction.notes.quarantine_action = DENY;\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"connection.notes.quarantine_action = OK;\nconnection.transaction.notes.quarantine_action = DENY;\n"}]}]}]}]},"navigation":{"title":"quarantine"},"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"quarantine-plugin"},"children":[{"type":"text","value":"quarantine plugin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin will save a message (in message/rfc822 format) to a specified\ndirectory, which will be created automatically if it does not already exist,\na dated sub-folder is also added to the end of the path specified in YYYYMMDD\nformat."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is designed to be used by other plugins which request the message be\nquarantined by setting a connection or transaction note that this plugin\nchecks."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"NOTE: this plugin simply saves a copy of the message.  It does not reject or\ndiscard the message and relies on another plugin to perform this function."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It uses the 'queue' hook, so that it runs after all the 'data_post' plugins\nand should be listed in 'config/plugins' to run before your queue hooks that\nperform actual deliveries."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To ensure that only completely written files are present in the quarantine,\nthe files are written to a temporary directory first and then hardlinked to\nthe final destination before the temporary file is deleted."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The temporary directory is 'quarantine_path/tmp' which defaults to:\n/var/spool/haraka/quarantine/tmp."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Upon start-up, any files present in the temporary directory are deleted\nsyncronously prior to any messages being accepted."}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This plugin looks for 'quarantine.ini' in the config directory."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"quarantine_path                   (default: /var/spool/haraka/quarantine)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The default base path to save the quarantine files to.  It will be created\nif it does not already exist."}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you wish to keep a copy of the message in your plugin, simply either:"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine = [ 1 | true | 'sub/directory/path' ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":"connection.notes.quarantine "}]},{"type":"element","tag":"span","props":{"class":"ct-02d2de"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"class":"ct-657beb"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-02d2de"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-657beb"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-02d2de"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c25163"},"children":[{"type":"text","value":"'sub/directory/path'"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" ];"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"or"}]},{"type":"element","tag":"code","props":{"code":"connection.transaction.notes.quarantine = [ 1 | true | 'sub/directory/path' ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":"connection.transaction.notes.quarantine "}]},{"type":"element","tag":"span","props":{"class":"ct-02d2de"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"class":"ct-657beb"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-02d2de"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-657beb"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-02d2de"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c25163"},"children":[{"type":"text","value":"'sub/directory/path'"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" ];"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"e.g."}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine = 1;\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":"connection.notes.quarantine "}]},{"type":"element","tag":"span","props":{"class":"ct-02d2de"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-657beb"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"would save the message to '/var/spool/quarantine/haraka/YYYYMMDD/UUID' where\nYYYMMDD and UUID are expanded to current date and transaction UUID."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"and"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine = 'corpus';\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":"connection.notes.quarantine "}]},{"type":"element","tag":"span","props":{"class":"ct-02d2de"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c25163"},"children":[{"type":"text","value":"'corpus'"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"would save the message to '/var/spool/quarantine/haraka/corpus/YYYYMMDD/UUID'."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: you can specify 'corpus/foo' or 'corpus/foo/bar' and the directories will\nbe automatically created.  Do not add any leading or trailing slashes."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default - after the message is quarantined, the plugin will tell Haraka to\ncontinue to the next plugin.  You can specify a different action like DENY or\nOK and supply an optional message using the following notes:"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine_action = [ OK, 'Message quarantined' ];\nconnection.transaction.notes.quarantine_action = [ DENY, 'Message rejected' ];\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":"connection.notes.quarantine_action "}]},{"type":"element","tag":"span","props":{"class":"ct-02d2de"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"class":"ct-657beb"},"children":[{"type":"text","value":"OK"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-c25163"},"children":[{"type":"text","value":"'Message quarantined'"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" ];"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":"connection.transaction.notes.quarantine_action "}]},{"type":"element","tag":"span","props":{"class":"ct-02d2de"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"class":"ct-657beb"},"children":[{"type":"text","value":"DENY"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-c25163"},"children":[{"type":"text","value":"'Message rejected'"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" ];"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you don't want to supply a specific message back to the client you can\nalso just specify a return code:"}]},{"type":"element","tag":"code","props":{"code":"connection.notes.quarantine_action = OK;\nconnection.transaction.notes.quarantine_action = DENY;\n","language":"javascript"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":"connection.notes.quarantine_action "}]},{"type":"element","tag":"span","props":{"class":"ct-02d2de"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-657beb"},"children":[{"type":"text","value":"OK"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":"connection.transaction.notes.quarantine_action "}]},{"type":"element","tag":"span","props":{"class":"ct-02d2de"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-657beb"},"children":[{"type":"text","value":"DENY"}]},{"type":"element","tag":"span","props":{"class":"ct-88c91d"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-c25163{color:#0A3069}\n.ct-657beb{color:#0550AE}\n.ct-02d2de{color:#CF222E}\n.ct-88c91d{color:#24292F}\n.dark .ct-88c91d{color:#C9D1D9}\n.dark .ct-02d2de{color:#FF7B72}\n.dark .ct-657beb{color:#79C0FF}\n.dark .ct-c25163{color:#A5D6FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuration","depth":2,"text":"Configuration"},{"id":"usage","depth":2,"text":"Usage"}]}},"_type":"markdown","_id":"content:8.plugins:queue:quarantine.md","_source":"content","_file":"8.plugins/queue/quarantine.md","_extension":"md"}